---
title: é˜²æŠ–å’ŒèŠ‚æµ
category: javascript
---
### ä»€ä¹ˆæ˜¯é˜²æŠ–å’ŒèŠ‚æµï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

ä½ åœ¨å®é™…å¼€å‘ä¸­è‚¯å®šå†™è¿‡è¿™æ ·çš„ä¸šåŠ¡éœ€æ±‚ï¼Œéšç€æ»šåŠ¨æ¡æ»šåŠ¨åˆ¤æ–­æ»šåŠ¨è·ç¦»ï¼Œå®ç°å¯¼èˆªæ å›ºå®šåœ¨é¡¶éƒ¨ã€ä¸ºé¡µé¢ä¸åŒä¸šåŠ¡æ¨¡å—æ·»åŠ æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸæ˜¾ç¤ºåŠ¨ç”»ç­‰éœ€æ±‚ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ä»£ç åœ¨æ¯ä¸€æ¬¡æ»šåŠ¨äº‹ä»¶è§¦å‘æ—¶ä¾¿ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œæ»šåŠ¨äº‹ä»¶å±äºé«˜é¢‘äº‹ä»¶ï¼Œè§¦å‘ååˆ™å¯èƒ½å¯¼è‡´æµè§ˆå™¨å¡æ­»ï¼Œå¿…é¡»å¯¹å…¶è¿›è¡Œé˜²æŠ–æˆ–èŠ‚æµå¤„ç†è¿›è€Œæ§åˆ¶æ‰§è¡Œæ¬¡æ•°ã€‚

å¸¸è§çš„éœ€è¦é˜²æŠ–æˆ–èŠ‚æµé¢„å¤„ç†çš„äº‹ä»¶æœ‰ï¼š

ğŸ“¢é¼ æ ‡äº‹ä»¶ï¼Œonmousedownå’Œonmousemoveï¼Œè¿ç»­ç‚¹å‡»å’Œç§»åŠ¨

ğŸ“¢è¾“å…¥äº‹ä»¶ï¼Œonkeyupå’Œonkeydown

ğŸ“¢windowï¼Œresizeå’Œscroll

##### é˜²æŠ–ï¼ˆdebounceï¼‰

`è§¦å‘é«˜é¢‘äº‹ä»¶åï¼Œnç§’å†…äº‹ä»¶å†æ¬¡è§¦å‘ï¼Œåˆ™é‡æ–°å¼€å§‹è®¡æ—¶ï¼Œç›´åˆ°nç§’å†…åªè§¦å‘äº†ä¸€æ¬¡ï¼Œåˆ™æ‰§è¡Œå‡½æ•°`ã€‚æˆ‘ä»¬ç”¨ä¹˜åç”µæ¢¯æ¥æ‰“ä¸ªæ¯”æ–¹ï¼ˆä¸è€ƒè™‘ç”µæ¢¯è¶…è½½ï¼‰ï¼Œå½“ç”µæ¢¯é—¨è¦å…³é—­æ—¶ï¼Œçªç„¶åˆæœ‰äººéœ€è¦ä¹˜åç”µæ¢¯ï¼Œæ­¤æ—¶ç”µæ¢¯å¹¶æ²¡æœ‰æ”¹å˜æ¥¼å±‚ï¼Œè€Œæ˜¯å†æ¬¡æ‰“å¼€äº†ç”µæ¢¯é—¨ã€‚è¿™æ ·ç”µæ¢¯å»¶è¿Ÿäº†æ”¹å˜æ¥¼å±‚çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿä¼˜åŒ–äº†èµ„æºï¼ˆä¸€æ¬¡ï¼‰ã€‚

##### èŠ‚æµï¼ˆthrottleï¼‰

`è§¦å‘é«˜é¢‘äº‹ä»¶åï¼Œnç§’å†…äº‹ä»¶å¤šæ¬¡è§¦å‘åªæ‰§è¡Œä¸€æ¬¡ã€‚` è¿™å°±å¥½æ¯”'æ°´æ»´æ•ˆåº”'ğŸ’§æ°´ç§¯æ”’åˆ°ä¸€å®šé‡é‡æ‰ä¼šä¸‹è½ã€‚

##### äºŒè€…åŒºåˆ«

é˜²æŠ–å’ŒèŠ‚æµçš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å¤„ç†å‡½æ•°**æ‰§è¡Œæ¬¡æ•°çš„ä¸åŒ**ã€‚

ğŸ‘£é˜²æŠ–å°†å¤šæ¬¡æ‰§è¡Œå˜ä¸º**æœ€åæ‰§è¡Œä¸€æ¬¡** ï¼Œ`å½’ä¸€`ï¼›

ğŸ‘£èŠ‚æµå°†å¤šæ¬¡æ‰§è¡Œå˜æˆ**æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡** ï¼Œ`ç¨€é‡Š`ï¼›

### é˜²æŠ–å®ç°

âšª**é’é“œ**

```js
function debounce(fn, wait) {
  let timer = null;// ç»´æŠ¤ä¸€ä¸ªtimer
  return function () {
    // é€šè¿‡`this`å’Œ`arguments`ç¼“å­˜å‡½æ•°çš„ä½œç”¨åŸŸå’Œå‚æ•°
    let context = this;
    let args = arguments;
    clearTimeout(timer);//æ¸…é™¤æœ€åä¸€æ¬¡ç‚¹å‡»ä¹‹å‰è§¦å‘çš„äº‹ä»¶
    timer = setTimeout(function () {
      fn.apply(context, args);
    }, wait);
  }
}

// æ³¨æ„ fnæ— è¿”å›å€¼ï¼ˆé»˜è®¤undefinedï¼‰
```

ğŸ”˜**ç™½é“¶**

æ·»åŠ immediateå‚æ•°ï¼Œ**æ§åˆ¶è§¦å‘åæ˜¯å¦ç«‹å³æ‰§è¡Œ**ã€‚

```js
function debounce(fn, wait = 800, immediate = true) {
  let timer;
  return function () {
    let context = this;
    let args = arguments;
+   timer && clearTimeout(timer);
+   if (immediate) {
+     // é¦–æ¬¡è§¦å‘ï¼Œtimeré»˜è®¤ä¸ºå‡å€¼ã€‚
+     // è‹¥è¿ç»­è§¦å‘ï¼Œåˆ™timerä¸ºsetTimeoutè¿”å›çš„æœ€æ–°çš„IDå€¼[Number]ï¼Œåˆ™runNowä¸ºfalseã€‚
+     let runNow = !timer;
+     // æŒ‡å®šæ—¶é—´waitè¿‡åæ‰å°†å®šæ—¶å™¨æ¸…é™¤
+     timer = setTimeout(function () {
+       timer = null;
+     }, wait);
+     if (runNow) fn.apply(context, args)
    } else {
      timer = setTimeout(function () {
        fn.apply(context, args);
      }, wait);
    }
  }
};
// æ³¨æ„ fnæ— è¿”å›å€¼ï¼ˆé»˜è®¤undefinedï¼‰
```

âš«**é»„é‡‘**

**ä¸ºäº‹ä»¶å¤„ç†å‡½æ•°fnæ·»åŠ è¿”å›å€¼**ã€‚ç›®å‰è¦è¿”å›å€¼çš„è¯ï¼Œåªèƒ½åœ¨immediateä¸ºtrueæ—¶è¿”å›ã€‚å› ä¸ºelseè¯­å¥ä¸­ä¸ºå¼‚æ­¥ä»£ç æ‰§è¡Œï¼Œæ‰€ä»¥è¿”å›çš„éƒ½æ˜¯undefinedã€‚

```js
function debounce(fn, wait = 800, immediate = true) {
  let timer;
  return function () {
    let context = this, args = arguments;
    timer && clearTimeout(timer);
    if (immediate) {
      // é¦–æ¬¡è§¦å‘ï¼Œtimeré»˜è®¤ä¸ºå‡å€¼ã€‚
      // è‹¥è¿ç»­è§¦å‘ï¼Œåˆ™timerä¸ºsetTimeoutè¿”å›çš„æœ€æ–°çš„IDå€¼[Number]ï¼Œåˆ™runNowä¸ºfalseã€‚
      let runNow = !timer;
      // æŒ‡å®šæ—¶é—´waitè¿‡åæ‰å°†å®šæ—¶å™¨æ¸…æ¥š
      timer = setTimeout(function () {
        timer = null;
      }, wait);
+     if (runNow) return fn.apply(context, args)
    } 
    else {
      timer = setTimeout(function () {
        return fn.apply(context, args);
      }, wait);
    }
  }
};
```

ğŸ”µ**é“‚é‡‘**

å®ç°åœ¨**ç­‰å¾…æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å–æ¶ˆå»¶è¿Ÿå¹¶ç«‹å³æ‰§è¡Œå‡½æ•°fn**

```js
function debounce(fn, wait = 800, immediate = true) {
+ let timer, debounced;
+ debounced = function () {
    let context = this, args = arguments;
    timer && clearTimeout(timer);
    if (immediate) {
      // é¦–æ¬¡è§¦å‘ï¼Œtimeré»˜è®¤ä¸ºå‡å€¼ã€‚
      // è‹¥è¿ç»­è§¦å‘ï¼Œåˆ™timerä¸ºsetTimeoutè¿”å›çš„æœ€æ–°çš„IDå€¼[Number]ï¼Œåˆ™runNowä¸ºfalseã€‚
      let runNow = !timer;
      // æŒ‡å®šæ—¶é—´waitè¿‡åæ‰å°†å®šæ—¶å™¨æ¸…æ¥š
      timer = setTimeout(function () {
        timer = null;
      }, wait);
      if (runNow) return fn.apply(context, args)
    }
    else {
      timer = setTimeout(function () {
        return fn.apply(context, args);
      }, wait);
    }
  }
+ debounced.cancel = () => {
+   clearTimeout(timer)
+   timer = null
+ }
+ return debounced
};
```

### èŠ‚æµå®ç°

ğŸ”˜**ç™½é“¶ï¼ˆæ—¶é—´æˆ³ï¼‰**

```js
//æŒ‡å®šæ—¶é—´å†…è§¦å‘ï¼Œæ—¶é—´ä¸€åˆ°å°±ä¼šè§¦å‘ï¼ˆä¸ç®¡ä½ æ‰§è¡Œäº†å¤šå°‘æ¬¡ï¼‰
//æ€è·¯ï¼šå®šä¹‰ä¸€ä¸ªä¸Šæ¬¡çš„æ—¶é—´ï¼Œæ—¶é—´è§¦å‘è·å–å½“å‰æ—¶é—´ï¼Œæ»¡è¶³ã€å½“å‰æ—¶é—´-ä¸Šæ¬¡æ—¶é—´>å»¶è¿Ÿæ—¶é—´ã€‘åˆ™è§¦å‘ï¼Œç„¶åæ›´æ–°ä¸Šæ¬¡æ—¶é—´previousã€‚
function throttle(func, delay) {
  let previous = 0;
  return function () {
    let now = new Date();
    if (now - previous > delay) {
      func.apply(this, arguments);
      previous = now;
    }
  }
}
```

ğŸ”˜**ç™½é“¶ï¼ˆå®šæ—¶å™¨ï¼‰**

```js
// æ€è·¯ï¼šäº‹ä»¶è§¦å‘æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå®šæ—¶å™¨æœªæ‰§è¡Œå‰å†æ¬¡è§¦å‘äº‹ä»¶åˆ™ä¸æ‰§è¡Œï¼›å®šæ—¶å™¨æ‰§è¡Œï¼Œåˆ™æ‰§è¡Œå‡½æ•°ï¼Œç„¶åæ¸…ç©ºå®šæ—¶å™¨ï¼Œå†è®¾ç½®ä¸‹ä¸€ä¸ªå®šæ—¶å™¨ã€‚
function throttle(fn, delay) {
  let timer;
  return function () {
    let context = this, args = arguments;
    if (!timer) {
      timer = setTimeout(() => {
        timer = null;
        fn.apply(context, args)
      }, delay);
    }
  }
}
```

âš«**é»„é‡‘**

åˆäºŒä¸ºä¸€ï¼ˆæœ‰å¤´æœ‰å°¾ï¼‰ï¼›æœ‰å¤´â€”â€”è§¦å‘æ—¶ä¾¿æ‰§è¡Œä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡é—´éš”åˆ°äº†å†æ‰§è¡Œä¸€æ¬¡ï¼›æœ‰å°¾â€”â€”åœæ­¢è§¦å‘ï¼Œä¼šæ›´æ ¹æ®è®¡ç®—æ¡ä»¶å†æ‰§è¡Œä¸€æ¬¡

```js
// ç¬¬ä¸€æ¬¡è§¦å‘å³æ‰§è¡Œï¼Œç„¶åæ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œï¼Œæœ€ååœæ­¢å†æ—¶é—´é—´éš”ç»“æŸæ—¶æ‰§è¡Œä¸€æ¬¡
function throttle(fn, delay) {
  let timer, context, args,
      // è®°å½•ä¸Šæ¬¡è§¦å‘çš„æ—¶é—´
      previous = 0;
  return function () {
    let now = +new Date(),
        //ä¸‹æ¬¡è§¦å‘fnå‰©ä½™çš„æ—¶é—´
        remaining = delay - (now - previous);
    context = this;
    args = arguments;
    // æ— å‰©ä½™æ—¶é—´ï¼Œæˆ–ç³»ç»Ÿæ—¶é—´æ”¹å˜(äººä¸º)
    if (remaining <= 0 || remaining > delay) {
      // é¦–æ¬¡è§¦å‘ä¼šç«‹å³æ‰§è¡Œæœ¬éƒ¨åˆ†
      if (timer) {
        clearTimeout(timer)
        timer = null;
      }
      previous = now;
      fn.apply(context, args)
    } else if (!timer) {
      // è®¾ç½®å®šæ—¶å™¨
      timer = setTimeout(() => {
        fn.apply(context, args)
        previous = +new Date();
        timer = null;
      }, remaining);
    }
  }
}
// æ­£å¸¸ä¸€æ¬¡è¿ç»­è§¦å‘çš„æ‰§è¡Œåº”è¯¥æ˜¯ï¼š ä¸€æ¬¡ifï¼Œç„¶åæ¯æ¬¡éƒ½æ˜¯else ifï¼ˆæœ€åä¸€æ¬¡ä¹Ÿæ˜¯ï¼‰ï¼Œ
```

### underscoreä¸­é˜²æŠ–å’ŒèŠ‚æµæºç è§£æ

### æ€»ç»“

é˜²æŠ–å’ŒèŠ‚æµä¸»è¦æ˜¯æ»¡è¶³æ€§èƒ½ä¼˜åŒ–éœ€æ±‚å®ç°ï¼Œé¿å…æ„å¤–é”™è¯¯ã€‚

##### ğŸ”—**å‚è€ƒ**

- [èŠ‚æµ](https://github.com/mqyqingfeng/Blog/issues/26)
- [é˜²æŠ–](https://github.com/mqyqingfeng/Blog/issues/22)
- [underscore](https://underscorejs.net/)